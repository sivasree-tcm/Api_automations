<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Enterprise API Intelligence</title>

    <style>
        *{margin:0;padding:0;box-sizing:border-box}

        :root{
         --bg:#08080c;--card:#12121e;--panel:#1a1a2b;
         --pass:#00ff95;--fail:#ff0055;
         --txt:#fff;--dim:#8b8ba7;--brd:#252538;
        }

        body{font-family:Arial;background:var(--bg);color:var(--txt)}
        header{padding:20px 40px;border-bottom:1px solid var(--brd);font-weight:800;display:flex;justify-content:space-between;align-items:center}
        .header-title{font-size:18px}
        .header-date{font-size:14px;color:var(--dim)}
        .container{padding:30px 40px}

        /* SUMMARY */
        .cards{display:grid;grid-template-columns:repeat(5,1fr);gap:20px;margin-bottom:25px}
        .card{background:var(--card);padding:20px;border-radius:12px}
        .card h2{font-size:30px;margin-top:8px}
        .pass{color:var(--pass)} .fail{color:var(--fail)}

        .donut{
         width:180px;height:180px;border-radius:50%;
         background:conic-gradient(
          var(--pass) 0% __PASS_PERCENT__%,
          var(--fail) __PASS_PERCENT__% 100%
         );
         margin:auto
        }

        /* TOOLBAR */
        .toolbar{display:flex;gap:10px;margin-bottom:15px}
        input,select{
         background:var(--panel);
         border:1px solid var(--brd);
         color:#fff;padding:8px 12px;border-radius:6px
        }

        /* TABLE */
        .table{background:var(--card);border-radius:12px;overflow:hidden}
        table{width:100%;border-collapse:collapse}
        th,td{padding:14px;border-bottom:1px solid var(--brd)}
        th{color:var(--dim);font-size:12px;text-align:left}

        /* BADGES */
        .badge{
         padding:4px 10px;border-radius:4px;
         font-size:12px;font-weight:700
        }
        .b-pass{background:#00ff9520;color:var(--pass)}
        .b-fail{background:#ff005520;color:var(--fail)}

        .scenario-row{cursor:pointer}

        /* ðŸ”¥ CRITICAL FIX */
        .details{display:none;background:#050508}
        tr.details.active{display:table-row}
        div.details.active{display:block}

        /* TEST CASE */
        .testcase-card{
         display:flex;justify-content:space-between;align-items:center;
         background:#0f0f18;padding:12px 16px;margin:8px 0;
         border-radius:10px;border:1px solid #1f1f2f;
         cursor:pointer;transition:.2s
        }
        .testcase-card:hover{background:#151527}
        .tc-name{font-weight:600}
        .tc-right{display:flex;gap:10px;align-items:center}
        .tc-time{font-size:12px;color:#8b8ba7}

        /* STEPS */
        pre{
         background:#000;padding:12px;border-radius:6px;
         margin-top:6px;color:#9ad7ff;white-space:pre-wrap
        }

        /* PAGINATION */
        .pagination{
         margin-top:15px;display:flex;gap:10px;justify-content:center
        }
        button{
         background:var(--panel);border:1px solid var(--brd);
         color:#fff;padding:6px 14px;border-radius:6px;cursor:pointer
        }
        button:hover:not(:disabled){background:#252538}
        button:disabled{opacity:.4;cursor:not-allowed}
    </style>
</head>

<body>

<header>
    <div class="header-title">API INTELLIGENCE REPORT</div>
    <div class="header-date" id="reportDate"></div>
</header>

<div class="container">

    <div class="cards">
        <div class="card">TOTAL<h2 id="tot">0</h2></div>
        <div class="card">PASSED<h2 class="pass" id="pas">0</h2></div>
        <div class="card">FAILED<h2 class="fail" id="fai">0</h2></div>
        <div class="card">STABILITY<h2 id="rate">0%</h2></div>
        <div class="card"><div class="donut"></div></div>
    </div>

    <div class="toolbar">
        <input id="search" placeholder="Search scenario or test case">
        <select id="status">
            <option value="ALL">All</option>
            <option value="PASS">PASS</option>
            <option value="FAIL">FAIL</option>
        </select>
        <select id="sort">
            <option value="DEFAULT">Default</option>
            <option value="FAIL_FIRST">Fail First</option>
            <option value="NAME">Name</option>
        </select>
    </div>

    <div class="table">
        <table>
            <thead>
            <tr><th>Name</th><th>Status</th><th>Duration</th></tr>
            </thead>
            <tbody id="rows"></tbody>
        </table>
    </div>

    <div class="pagination" id="pagination"></div>
</div>

<script>
    const DATA = __REPORT_DATA__;

    /* FORMAT DATE AND TIME */
    function formatDateTime() {
        const now = new Date();
        const options = {
            year: 'numeric',
            month: 'short',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        };
        return now.toLocaleDateString('en-US', options);
    }

    /* Display Date/Time in Header */
    reportDate.innerText = formatDateTime();

    /* FORMAT DURATION */
    function formatDuration(ms) {
        if (ms >= 1000) {
            const seconds = (ms / 1000).toFixed(2);
            return seconds + 's';
        }
        return ms + 'ms';
    }

    /* COUNT TEST CASES (NOT SCENARIOS) */
    function countTestCases() {
        let total = 0;
        let passed = 0;
        let failed = 0;

        DATA.scenarios.forEach(scenario => {
            scenario.testCases.forEach(tc => {
                total++;
                if (tc.status === "PASS") {
                    passed++;
                } else if (tc.status === "FAIL") {
                    failed++;
                }
            });
        });

        return { total, passed, failed };
    }

    /* SUMMARY - COUNT TEST CASES */
    const counts = countTestCases();
    tot.innerText = counts.total;
    pas.innerText = counts.passed;
    fai.innerText = counts.failed;

    const passRate = counts.total > 0 ? ((counts.passed / counts.total) * 100).toFixed(2) : 0;
    rate.innerText = passRate + '%';

    /* HELPERS */
    function scenarioStatus(s){
     return s.testCases.some(tc=>tc.status==="FAIL")?"FAIL":"PASS";
    }
    function scenarioDuration(s){
     const totalMs = s.testCases.reduce((a,b)=>a+parseInt(b.duration),0);
     return formatDuration(totalMs);
    }

    /* FILTER / SORT / PAGINATION */
    let filtered=[...DATA.scenarios];
    let page=1;
    const size=5;

    function applyFilters(){
     const q=search.value.toLowerCase();
     const st=status.value;
     filtered=DATA.scenarios.filter(s=>{
      const scenarioMatch=s.name.toLowerCase().includes(q);
      const testMatch=s.testCases.some(tc=>tc.name.toLowerCase().includes(q));
      const statusMatch=st==="ALL"||scenarioStatus(s)===st;
      return (scenarioMatch||testMatch)&&statusMatch;
     });
     page=1;
     applySort();
    }

    function applySort(){
     if(sort.value==="FAIL_FIRST"){
      filtered.sort((a,b)=>scenarioStatus(a)==="FAIL"?-1:1);
     }else if(sort.value==="NAME"){
      filtered.sort((a,b)=>a.name.localeCompare(b.name));
     }
     render();
    }

    /* RENDER */
    function render(){
     rows.innerHTML="";
     const start=(page-1)*size;
     filtered.slice(start,start+size).forEach((s,i)=>{
      const idx=start+i;
      const st=scenarioStatus(s);

      rows.innerHTML+=`
      <tr class="scenario-row" onclick="toggleScenario('sc_${idx}')">
       <td><b>${s.name}</b></td>
       <td><span class="badge ${st==='PASS'?'b-pass':'b-fail'}">${st}</span></td>
       <td>${scenarioDuration(s)}</td>
      </tr>

      <tr id="sc_${idx}" class="details">
       <td colspan="3">
        ${s.testCases.map((tc,j)=>`
         <div class="testcase-card" onclick="toggleCase(event,'tc_${idx}_${j}')">
          <span class="tc-name">${tc.name}</span>
          <div class="tc-right">
           <span class="badge ${tc.status==='PASS'?'b-pass':'b-fail'}">${tc.status}</span>
           <span class="tc-time">${formatDuration(parseInt(tc.duration))}</span>
          </div>
         </div>
         <div id="tc_${idx}_${j}" class="details">
          ${tc.steps.map(st=>`
           <b>[${st.type}] ${st.label}</b>
           <pre>${st.value}</pre>
          `).join("")}
         </div>
        `).join("")}
       </td>
      </tr>`;
     });
     renderPagination();
    }

    function toggleScenario(id){
     document.getElementById(id).classList.toggle("active");
    }
    function toggleCase(e,id){
     e.stopPropagation();
     document.getElementById(id).classList.toggle("active");
    }

    /* PAGINATION */
    function renderPagination(){
     const total=Math.ceil(filtered.length/size)||1;
     pagination.innerHTML=`
     <button onclick="page--;render()" ${page===1?'disabled':''}>Prev</button>
     <span>${page}/${total}</span>
     <button onclick="page++;render()" ${page===total?'disabled':''}>Next</button>`;
    }

    /* EVENTS */
    search.onkeyup=applyFilters;
    status.onchange=applyFilters;
    sort.onchange=applySort;

    render();
</script>

</body>
</html>