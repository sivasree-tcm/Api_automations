
  trigger:
    - main

  # ✅ Daily schedule at 11:00 AM IST
  schedules:
    - cron: "30 5 * * *"   # 11:00 AM IST (UTC +5:30)
      displayName: "Daily API Automation Run - 11 AM IST"
      branches:
        include:
          - main
      always: true

  pool:
    vmImage: 'ubuntu-latest'

  steps:
    # 1️⃣ Run API automation tests
    - task: Maven@3
      displayName: 'Run API Automation Tests'
      inputs:
        mavenPomFile: 'pom.xml'
        goals: 'clean test'
        publishJUnitResults: true
        testResultsFiles: '**/surefire-reports/TEST-*.xml'

    # 2️⃣ Copy files to Staging
    - task: CopyFiles@2
      displayName: 'Stage Report Files'
      inputs:
        SourceFolder: '$(Build.SourcesDirectory)/target/report'
        Contents: '**'
        TargetFolder: '$(Build.ArtifactStagingDirectory)/AutomationReport'

    # 3️⃣ Publish the Artifact
    - task: PublishBuildArtifacts@1
      displayName: 'Publish Artifacts'
      inputs:
        PathtoPublish: '$(Build.ArtifactStagingDirectory)/AutomationReport'
        ArtifactName: 'CustomApiDashboard'