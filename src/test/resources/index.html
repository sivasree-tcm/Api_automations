<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Enterprise API Intelligence</title>

    <style>
        *{margin:0;padding:0;box-sizing:border-box}

        :root{
          --bg:#08080c;--card:#12121e;--panel:#1a1a2b;
          --acc:#00e5ff;--pass:#00ff95;--fail:#ff0055;
          --txt:#fff;--dim:#8b8ba7;--brd:#252538;
        }

        body{font-family:Arial;background:var(--bg);color:var(--txt)}
        header{padding:20px 40px;border-bottom:1px solid var(--brd);color:var(--acc);font-weight:800}
        .container{padding:30px 40px}

        .cards{display:grid;grid-template-columns:repeat(4,1fr);gap:20px;margin-bottom:30px}
        .card{background:var(--card);padding:20px;border-radius:12px}
        .card h2{font-size:34px;margin-top:8px}
        .pass{color:var(--pass)} .fail{color:var(--fail)}

        .layout{display:grid;grid-template-columns:260px 1fr;gap:30px}
        .donut{
          width:220px;height:220px;border-radius:50%;
          background:conic-gradient(
            var(--pass) 0% __PASS_PERCENT__%,
            var(--fail) __PASS_PERCENT__% 100%
          );
        }

        .toolbar{display:flex;gap:10px;margin-bottom:15px}
        input,select{
          background:var(--panel);border:1px solid var(--brd);
          color:#fff;padding:8px 12px;border-radius:6px
        }

        .table{background:var(--card);border-radius:12px;overflow:hidden}
        table{width:100%;border-collapse:collapse}
        th,td{padding:14px;border-bottom:1px solid var(--brd)}
        th{color:var(--dim);font-size:12px;text-align:left}

        .badge{padding:4px 10px;border-radius:4px;font-size:12px;font-weight:700}
        .b-pass{background:#00ff9520;color:var(--pass)}
        .b-fail{background:#ff005520;color:var(--fail)}

        .details{display:none;background:#050508}
        .details.active{display:table-row}
        pre{background:#000;padding:12px;border-radius:6px;margin-top:8px;color:#9ad7ff}

        .pagination{margin-top:15px;display:flex;gap:10px;justify-content:center}
        button{background:var(--panel);border:1px solid var(--brd);color:#fff;padding:6px 14px;border-radius:6px}
        button:disabled{opacity:.3}
    </style>
</head>

<body>

<header>API INTELLIGENCE</header>

<div class="container">

    <div class="cards">
        <div class="card">TOTAL<h2 id="tot">0</h2></div>
        <div class="card">PASSED<h2 class="pass" id="pas">0</h2></div>
        <div class="card">FAILED<h2 class="fail" id="fai">0</h2></div>
        <div class="card">STABILITY<h2 id="rate">0%</h2></div>
    </div>

    <div class="layout">
        <div class="card"><div class="donut"></div></div>

        <div>
            <div class="toolbar">
                <input id="search" placeholder="Search test..." onkeyup="applyFilters()">
                <select id="status" onchange="applyFilters()">
                    <option value="ALL">All</option>
                    <option value="PASS">PASS</option>
                    <option value="FAIL">FAIL</option>
                </select>
                <select id="sort" onchange="applySort()">
                    <option value="DEFAULT">Default</option>
                    <option value="FAIL_FIRST">Fail First</option>
                    <option value="NAME">Name</option>
                </select>
            </div>

            <div class="table">
                <table>
                    <thead>
                    <tr><th>Test</th><th>Status</th><th>Duration</th></tr>
                    </thead>
                    <tbody id="rows"></tbody>
                </table>
            </div>

            <div class="pagination" id="pagination"></div>
        </div>
    </div>
</div>

<script>
    const DATA = __REPORT_DATA__;

    document.getElementById("tot").innerText = DATA.summary.total;
    document.getElementById("pas").innerText = DATA.summary.passed;
    document.getElementById("fai").innerText = DATA.summary.failed;
    document.getElementById("rate").innerText = DATA.summary.passRate;

    let filtered = [...DATA.tests];
    let page = 1;
    const size = 3;
    const rows = document.getElementById("rows");

    function applyFilters(){
      const q = document.getElementById("search").value.toLowerCase();
      const st = document.getElementById("status").value;

      filtered = DATA.tests.filter(t =>
        t.name.toLowerCase().includes(q) &&
        (st === "ALL" || t.status === st)
      );
      page = 1;
      render();
    }

    function applySort(){
      const s = document.getElementById("sort").value;
      if(s === "FAIL_FIRST"){
        filtered.sort((a,b)=>a.status==="FAIL"?-1:1);
      }else if(s === "NAME"){
        filtered.sort((a,b)=>a.name.localeCompare(b.name));
      }
      render();
    }

    function render(){
      rows.innerHTML="";
      const start = (page-1)*size;
      const data = filtered.slice(start,start+size);

      data.forEach((t,i)=>{
        const idx = start+i;
        rows.innerHTML += `
          <tr onclick="toggle(${idx})" style="cursor:pointer">
            <td>${t.name}</td>
            <td><span class="badge ${t.status==='PASS'?'b-pass':'b-fail'}">${t.status}</span></td>
            <td>${t.duration}</td>
          </tr>
          <tr id="d${idx}" class="details">
            <td colspan="3">
              ${t.steps.map(s=>`<b>[${s.type}] ${s.label}</b><pre>${s.value}</pre>`).join("")}
            </td>
          </tr>
        `;
      });

      renderPagination();
    }

    function toggle(i){
      document.getElementById("d"+i).classList.toggle("active");
    }

    function renderPagination(){
      const total = Math.ceil(filtered.length/size);
      document.getElementById("pagination").innerHTML = `
        <button onclick="page--;render()" ${page===1?'disabled':''}>Prev</button>
        <span>${page}/${total}</span>
        <button onclick="page++;render()" ${page===total?'disabled':''}>Next</button>
      `;
    }

    render();
</script>

</body>
</html>
